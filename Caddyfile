# Caddyfile (Placez ce fichier à la racine de votre dépôt)
{
    # Activation de la compression
    encode zstd gzip
    # Masquage de l'en-tête Server pour la sécurité
    header -Server
}

# Caddy écoute sur le port HTTP standard à l'intérieur du conteneur.
# Coolify/Traefik gère HTTPS en amont et route vers ce port.
# On fait ensuite un reverse proxy vers l'application Node.js qui
# écoute sur le port $PORT (injecté par Coolify, défaut 3000).
:80 {
    # Gère les appels API en premier
    handle_path /api/* {
        reverse_proxy localhost:{$PORT:3000}
    }

    # Gère toutes les autres requêtes (fichiers statiques/SPA) ensuite
    handle {
        # Laisse server.js (Node.js) gérer le service des fichiers
        # statiques et le fallback SPA via express.static et app.get('*')
        reverse_proxy localhost:{$PORT:3000}
    }
}
